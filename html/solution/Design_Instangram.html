<html>
<body>



<pre><code>

  <li><a href="https://www.educative.io/courses/grokking-the-system-design-interview/m2yDVZnQ8lG">Designing Instagram (grokking system design)</a>  </li>
Storage for photo:
say everyday 2m photos created and average photo size 200kb, total storage is 2m * 200kB = 400 * 10^9Byte = 400GB.
one day we need 400GB disk, and one month, we need 12TB disk, so photos cannot be stored in one machine, what we need is
distributed file storage such as S3.

storeage for table
image table:
id 4byte + user id 4byte + title 50byte + createdAt 50 byte + image path = 256Byte = 364 Byte
364Byte * 2m = 0.7G per day, 21GB per month. 240GB per year.

user table:
id 4Byte + name 20byte + email 50byte + created At 4Byte + last login 4Byte = 82byte
say there is 500M user. total size = 82 Byte * 500M = 40GB

Friendship table:
id 4byte, from 4 byte, to 4 byte, total 12byte
500M users, each user follow 100 user, total = 500M * 100 * 12byte = 0.6TB.

QPS:
say there are 500M user, 1M daily active user, each user does 10 read operation per day.
say there are 500M daily active user, each user does 1 write operation per day.

Read QPS = 1M * 10/86400 = 100.
Write QPS = 10

Bandwidth:
bandwidth = QPS * average size/per request or response
if average size per response 2M

outgoing bandwidth = 100 * 2M = 200M/s

Table schema:
User table
id          int PK
name        varchar(25)
email       varchar(30)
updatedAt   timestamp
createdAt   timestamp

photo table
id        int  PK
userId    int  FK
title     varchar(50)
createdAt timeStamp
ImagePath varChar(50)


frinedship table
id    int PK
from  int
to    int

Generate News feed for sam whose user id is 1

select photo.title, photo.user_id, photo.createdAt from
(select * from friendship where from_user = 1) as f
left join photo
on f.to_user = photo.user_id
order by photo.createdAt;




// Sql statment to creat table and insert value
 create database ins  // create database
 use ins// use database

 // create user table
create table user(id int not null auto_increment, name varchar(50) not null, email varchar(50), primary key (id));
 // insert value;
 insert into user (name, email) values ("Lyn", "lzengzeng22@gmail.com");
insert into user (name, email) values ("Mark", "mark@gmail.com");
insert into user (name, email) values ("Jay", "mark@gmail.com");
insert into user (name, email) values ("NanXia", "Nan@gmail.com");
insert into user (name, email) values ("Jing", "Jing@gmail.com");

// create friendship table;
create table friendship(id int not null auto_increment, from_user int not null, to_user int not null, primary key (id));
insert into friendship (from_user, to_user) values (1, 2);
insert into friendship (from_user, to_user) values (1, 3);
insert into friendship (from_user, to_user) values (1, 3);
insert into friendship (from_user, to_user) values (2, 5);

// create photo table
create table photo(id int not null auto_increment primary key, user_id int not null, title varchar(100) not null, image_path varchar(50) not null, createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP );
insert into photo (user_id, title, image_path) values (3, "Japan photo", "Azure/Jay");
insert into photo (user_id, title, image_path) values (2, "California San Diego photo", "Azure/Mark");
insert into photo (user_id, title, image_path) values (3, "Cancun trip", "Azure/Jay");




// Query to get news feed of user 1's friends;

select photo.title, photo.user_id, photo.createdAt from
(select * from friendship where from_user = 1) as f
left join photo
on f.to_user = photo.user_id
order by photo.createdAt;


// Optimization to create index on photo id and photo creation time.
create index idx_on_photo_id_and_creationTime on photo(id, createdAt);

</code></pre>




</body>



</html>
