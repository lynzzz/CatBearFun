<html>

<head>
   <link rel="stylesheet" type="text/css" href="../../css/utility.css">     <!-- external css file -->
</head>

<body>
<pre><code>
1.                                        Capacity estimation:
Daily Active Driver: 500k
Daily Active rider : 1M

Driver pings server in every 4 seconds.

SO, QPS from driver side is 125k. All write traffic.
QPS from rider side. 

Say rider request rides once a day. 1M * 1/ 86400 = 10. 





2. Do we update quad tree everytime driver updates the location?
No. If we do, we need to find the previous grid the driver belongs, if it moves out of that grid,
we need to delete that from old grid, and add that driver to new grid. If it exceeds the limit, we need 
to repartition the grid.

This update is expensive, so it is not guaranteed the update can be done in 4 seconds.


3. Instead, we keep a table of driver loation. Do the update every 4 sec.
Table schema:
Driver ID 3 bytes :
old lat : 8 bytes
old long : 8 bytes
new lat : 8 bytes
new long : 8 bytes

total 35bytes.
We have 500k active drivers, 500k * 35byte = 18MB


4. How much bandwidth needed?

500K/4 * (3 + 8 +8)byte = 2.1MB/s


5. Do we need to partition drivers table?
Yes, for scalability consideration. What's partiton key? Driver ID, consistent hashing


6. What does location server do once it gets update from driver?
a. broadcast the new location to subscribed customers
b. update quad tree in every 15 sec.




Driver Location server updates quadTree Server( every 15 seconds)
Driver location server notifies clients. (subscribe/notify, every 4 seconds)

Client gets pushed by driver table and at the same time pull quadtree server to get new car and delte old car out of range.

 


</code></pre>
</body>
