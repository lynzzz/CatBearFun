<html>

<body>



<pre><code>
Version I:
Message Table
ID          Primary key
From_user   Foreign key
To_user     Foreign key
Content     text
time        TimeStamp

How to get conversation between A and B?
select * from Message_Table where From_user = A and To_User = B or From_user = B and
to_User = A orderby time desc limit 20.

Pitfall:
1. Sql is complex and it results in poor performance
2. Do not support group Chat


Version II:
Message_Table
ID           Primary key
From_user    Foreign key
Thread_ID    Foreign key
Context      text
time         TimeStamp

Thread_Table
Thread ID          Primary Key
Participant_User   text
updated_at         time
created_at         time

把Version I Message table去掉To_User 加上Thread ID 成了新的Message Table, 在加一个Thread Table, 用ThreadID 来Join

Example:
Action 1: A -> {A B C}  Hi 1:20

在Thread table 加一行
2908 {ABC}  1:20  1:20

Message table:
1 A 2908 Hi 1:20

Action 2: B-> {A B C}  Hello 2:05

ThreadTable
2908 {A B C} 2:05 1:20

Message Table
1 A 2908 Hi    1:20
2 B 2908 Hello 2:05

Action 3: C is on line, pull the server
select Thread ID from Thread_Table where participant_user contains C
for( thread ID : all ThreadIDs){
    select * from Message_Table where thraed_ID = ID
}

Question: How to get thread ID in the server
Thread ID =   Hash(sort(all participant names))   No conflict

Follow up question: How to handle private property? Mute, unread message
</code></pre>




</body>



</html>
